(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[963],{963:function(t,e,n){"use strict";n.d(e,{IsnadProvider:function(){return d},c:function(){return f}});var r,a,s=n(7437),i=n(2265),o=n(9768),l=n(357);let u={useMock:"false"!==l.env.NEXT_PUBLIC_USE_MOCK,pxeUrl:null!==(r=l.env.NEXT_PUBLIC_PXE_URL)&&void 0!==r?r:"http://localhost:8080",contractAddress:null!==(a=l.env.NEXT_PUBLIC_CONTRACT_ADDRESS)&&void 0!==a?a:"0x0000000000000000000000000000000000000000000000000000000000000000",appName:"The Isnad Chain",appDescription:"ZK Skill Attestation & Credential Registry for AI Agents",version:"0.1.0-devnet"},c=(0,i.createContext)(null);function d(t){let{children:e}=t,[n,r]=(0,i.useState)(null),[a,l]=(0,i.useState)(null),[d,f]=(0,i.useState)(!1),[h,y]=(0,i.useState)(null),[m,v]=(0,i.useState)([]),[w,g]=(0,i.useState)([]),p=(0,i.useCallback)(()=>{n&&v(n.getMyAttestations())},[n]),b=(0,i.useCallback)(()=>{n&&g(n.listCredentials())},[n]),A=(0,i.useCallback)(async()=>{f(!0),y(null);try{if(u.useMock){let t="0x2f5e9c1a4b8d7f3e6a2c5b8d1f4e7a3c9b6e2d5f8a1c4b7e3d6a9f2c5b8e1d4";await new Promise(t=>setTimeout(t,800));let e=new o.zW(t);r(e),l(t)}else throw Error("Real SDK not yet activated.\n\nPrerequisites:\n  1. Docker accessible (docker ps)\n  2. Run: scripts/activate-real-sdk.sh\n\n"+"PXE target: ".concat(u.pxeUrl,"\n")+"Contract: ".concat(u.contractAddress))}catch(t){y(t instanceof Error?t.message:"Connection failed")}finally{f(!1)}},[]),C=(0,i.useCallback)(()=>{r(null),l(null),v([]),g([]),y(null)},[]);(0,i.useEffect)(()=>{n&&(v(n.getMyAttestations()),g(n.listCredentials()))},[n]);let k=a?"".concat(a.slice(0,8),"...").concat(a.slice(-6)):null;return(0,s.jsx)(c.Provider,{value:{sdk:n,isConnected:null!==n,displayAddress:k,walletAddress:a,connect:A,disconnect:C,error:h,isConnecting:d,myAttestations:m,refreshAttestations:p,credentialList:w,refreshCredentials:b},children:e})}function f(){let t=(0,i.useContext)(c);if(!t)throw Error("useIsnad must be used within <IsnadProvider>");return t}},9768:function(t,e,n){"use strict";n.d(e,{ri:function(){return o},zW:function(){return l}});let r=[{hash:"0x7f3ac4b82d19e8a1f5b6c3d4e9f2a0b7c8d5e6f1a2b3c4d5e6f7a8b9c0d1e2f",score:847n,count:9n,history:[{quality:95,daysAgo:2},{quality:88,daysAgo:3},{quality:92,daysAgo:5},{quality:78,daysAgo:7},{quality:100,daysAgo:9},{quality:85,daysAgo:12},{quality:90,daysAgo:15},{quality:72,daysAgo:18},{quality:47,daysAgo:21}]},{hash:"0x1a2b3c4d5e6f7a8b9c0d1e2f3a4b5c6d7e8f9a0b1c2d3e4f5a6b7c8d9e0f1a2",score:312n,count:4n,history:[{quality:88,daysAgo:1},{quality:75,daysAgo:4},{quality:82,daysAgo:6},{quality:67,daysAgo:10}]},{hash:"0xdeadbeefcafebabe0102030405060708090a0b0c0d0e0f101112131415161718",score:0n,count:0n,history:[]}];function a(){let t=new Uint8Array(32);return"undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues(t),"0x"+Array.from(t).map(t=>t.toString(16).padStart(2,"0")).join("")}function s(){let t=3e3+2e3*Math.random();return new Promise(e=>setTimeout(e,t))}function i(){return new Promise(t=>setTimeout(t,300+200*Math.random()))}async function o(t){let e=await t.arrayBuffer();return"0x"+Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",e))).map(t=>t.toString(16).padStart(2,"0")).join("")}class l{get walletAddress(){return this.state.walletAddress}async getTrustScore(t){var e,n;await i();let r=t.toLowerCase(),a=this.state.trustScores.get(r);return{skillHash:t,trustScore:null!==(e=null==a?void 0:a.score)&&void 0!==e?e:0n,attestationCount:null!==(n=null==a?void 0:a.count)&&void 0!==n?n:0n}}async getAttestationHistory(t){var e;await i();let n=t.toLowerCase(),r=this.state.trustScores.get(n);return null!==(e=null==r?void 0:r.history)&&void 0!==e?e:[]}async attest(t,e){var n;let r=t.skillHash.toLowerCase();if(this.state.myAttestations.some(t=>t.skillHash.toLowerCase()===r&&!t.revoked))throw Error("You have already attested this skill (SingleUseClaim prevents double-attestation).");null==e||e("proving"),await s(),null==e||e("submitting"),await new Promise(t=>setTimeout(t,500));let i=a(),o=new Date,l=null!==(n=this.state.trustScores.get(r))&&void 0!==n?n:{score:0n,count:0n,history:[]};return this.state.trustScores.set(r,{score:l.score+BigInt(t.quality),count:l.count+1n,history:[{quality:t.quality,ts:o},...l.history]}),this.state.myAttestations.unshift({skillHash:t.skillHash,quality:t.quality,timestamp:o,txHash:i,revoked:!1}),{txHash:i}}async revokeAttestation(t,e){let n=t.toLowerCase(),r=this.state.myAttestations.find(t=>t.skillHash.toLowerCase()===n&&!t.revoked);if(!r)throw Error("No active attestation found for this skill.");null==e||e("proving"),await s(),null==e||e("submitting"),await new Promise(t=>setTimeout(t,500));let i=a(),o=this.state.trustScores.get(n);return o&&this.state.trustScores.set(n,{score:o.score>=BigInt(r.quality)?o.score-BigInt(r.quality):0n,count:o.count>0n?o.count-1n:0n,history:o.history.filter(t=>t.ts!==r.timestamp)}),r.revoked=!0,{txHash:i}}getMyAttestations(){return[...this.state.myAttestations]}async storeCredential(t,e){if(this.state.credentials.has(t.keyId))throw Error("Credential '".concat(t.keyId,"' already exists. Use rotateCredential() to replace."));return null==e||e("proving"),await s(),null==e||e("submitting"),await new Promise(t=>setTimeout(t,500)),this.state.credentials.set(t.keyId,{label:t.label,value:t.value}),{txHash:a()}}async getCredential(t){await i();let e=this.state.credentials.get(t);return e?{keyId:t,value:e.value,label:e.label}:null}async deleteCredential(t,e){if(!this.state.credentials.has(t))throw Error("No credential found with keyId '".concat(t,"'."));return null==e||e("proving"),await s(),null==e||e("submitting"),await new Promise(t=>setTimeout(t,500)),this.state.credentials.delete(t),{txHash:a()}}async rotateCredential(t,e){if(!this.state.credentials.has(t.keyId))throw Error("No credential found with keyId '".concat(t.keyId,"'."));return null==e||e("proving"),await s(),null==e||e("submitting"),await new Promise(t=>setTimeout(t,500)),this.state.credentials.set(t.keyId,{label:t.newLabel,value:t.newValue}),{txHash:a()}}listCredentials(){return Array.from(this.state.credentials.entries()).map(t=>{let[e,{label:n}]=t;return{keyId:e,label:n}})}async grantCredentialAccess(t){var e;return await i(),{authwitNonce:null!==(e=t.nonce)&&void 0!==e?e:BigInt(Date.now())}}constructor(t){this.state=function(t){let e=new Map;for(let t of r){let n=Date.now();e.set(t.hash.toLowerCase(),{score:t.score,count:t.count,history:t.history.map(t=>{let{quality:e,daysAgo:r}=t;return{quality:e,ts:new Date(n-864e5*r)}})})}return{trustScores:e,myAttestations:[],credentials:new Map,walletAddress:t}}(t)}}},357:function(t,e,n){"use strict";var r,a;t.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(a=n.g.process)?void 0:a.env)?n.g.process:n(8081)},8081:function(t){!function(){var e={229:function(t){var e,n,r,a=t.exports={};function s(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===s||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:s}catch(t){e=s}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(t){n=i}}();var l=[],u=!1,c=-1;function d(){u&&r&&(u=!1,r.length?l=r.concat(l):c=-1,l.length&&f())}function f(){if(!u){var t=o(d);u=!0;for(var e=l.length;e;){for(r=l,l=[];++c<e;)r&&r[c].run();c=-1,e=l.length}r=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function h(t,e){this.fun=t,this.array=e}function y(){}a.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new h(t,e)),1!==l.length||u||o(f)},h.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=y,a.addListener=y,a.once=y,a.off=y,a.removeListener=y,a.removeAllListeners=y,a.emit=y,a.prependListener=y,a.prependOnceListener=y,a.listeners=function(t){return[]},a.binding=function(t){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(t){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},n={};function r(t){var a=n[t];if(void 0!==a)return a.exports;var s=n[t]={exports:{}},i=!0;try{e[t](s,s.exports,r),i=!1}finally{i&&delete n[t]}return s.exports}r.ab="//";var a=r(229);t.exports=a}()}}]);