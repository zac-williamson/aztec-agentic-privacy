import { createLogger } from '@aztec/foundation/log';
import { NoopTelemetryClient } from './noop.js';
export * from './config.js';
let initialized = false;
let telemetry = new NoopTelemetryClient();
export async function initTelemetryClient(config, bindings) {
    const log = createLogger('telemetry:client', bindings);
    if (initialized) {
        log.warn('Telemetry client has already been initialized once');
        return telemetry;
    }
    if (config.metricsCollectorUrl || config.publicMetricsCollectorUrl) {
        log.info(`Using OpenTelemetry client with custom collector`);
        // Lazy load OpenTelemetry to avoid loading heavy deps at startup
        const { OpenTelemetryClient } = await import('./otel.js');
        telemetry = OpenTelemetryClient.createAndStart(config, log);
    } else {
        log.info('Using NoopTelemetryClient');
    }
    initialized = true;
    return telemetry;
}
export function getTelemetryClient() {
    return telemetry;
}
