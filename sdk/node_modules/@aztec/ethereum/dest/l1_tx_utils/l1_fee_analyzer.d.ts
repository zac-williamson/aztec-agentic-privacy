import type { SlotNumber } from '@aztec/foundation/branded-types';
import { type Logger } from '@aztec/foundation/log';
import { DateProvider } from '@aztec/foundation/timer';
import { type Hex } from 'viem';
import type { ViemClient } from '../types.js';
import type { L1TxUtilsConfig } from './config.js';
import { type PriorityFeeStrategy } from './fee-strategies/index.js';
import type { L1BlobInputs, L1TxRequest } from './types.js';
/**
 * Information about a blob transaction in the pending pool or mined block
 */
export interface BlobTxInfo {
    hash: Hex;
    maxPriorityFeePerGas: bigint;
    maxFeePerGas: bigint;
    maxFeePerBlobGas: bigint;
    blobCount: number;
    gas: bigint;
}
/**
 * Snapshot of the pending block state at the time of analysis
 */
export interface PendingBlockSnapshot {
    /** Timestamp when the snapshot was taken */
    timestamp: number;
    /** The latest L1 block number at the time of snapshot */
    latestBlockNumber: bigint;
    /** Base fee per gas of the latest block */
    baseFeePerGas: bigint;
    /** Blob base fee at the time of snapshot */
    blobBaseFee: bigint;
    /** Total number of transactions in the pending block */
    pendingTxCount: number;
    /** Number of blob transactions in the pending block */
    pendingBlobTxCount: number;
    /** Total number of blobs in pending blob transactions */
    pendingBlobCount: number;
    /** Details of blob transactions in the pending pool */
    pendingBlobTxs: BlobTxInfo[];
    /** 75th percentile priority fee from pending transactions */
    pendingP75PriorityFee: bigint;
    /** 75th percentile priority fee from pending blob transactions */
    pendingBlobP75PriorityFee: bigint;
}
/**
 * Result of a strategy's priority fee calculation for analysis
 */
export interface StrategyAnalysisResult {
    /** Strategy ID */
    strategyId: string;
    /** Strategy name */
    strategyName: string;
    /** Calculated priority fee from this strategy */
    calculatedPriorityFee: bigint;
    /** Debug info from the strategy calculation */
    debugInfo?: Record<string, string | number>;
    /** Whether this transaction would have been included with this strategy's fee */
    wouldBeIncluded?: boolean;
    /** If not included, reason why */
    exclusionReason?: 'priority_fee_too_low' | 'block_full';
    /** Priority fee delta compared to minimum included fee */
    priorityFeeDelta?: bigint;
    /** Estimated total cost in ETH for this strategy */
    estimatedCostEth?: number;
    /** Estimated overpayment in ETH vs minimum required */
    estimatedOverpaymentEth?: number;
}
/**
 * Transaction metadata and strategy analysis results
 */
export interface ComputedGasPrices {
    /** Estimated gas limit for the transaction */
    gasLimit: bigint;
    /** Number of blobs in our transaction */
    blobCount: number;
    /** Results from all strategies analyzed */
    strategyResults?: StrategyAnalysisResult[];
}
/**
 * Information about what actually got included in the mined block
 */
export interface MinedBlockInfo {
    /** The block number that was mined */
    blockNumber: bigint;
    /** The block hash */
    blockHash: Hex;
    /** Timestamp of the mined block */
    blockTimestamp: bigint;
    /** Base fee per gas in the mined block */
    baseFeePerGas: bigint;
    /** Blob gas used in the mined block */
    blobGasUsed: bigint;
    /** Total number of transactions in the mined block */
    txCount: number;
    /** Number of blob transactions that got included */
    includedBlobTxCount: number;
    /** Total number of blobs included in the block */
    includedBlobCount: number;
    /** Details of blob transactions that got included */
    includedBlobTxs: BlobTxInfo[];
    /** Minimum priority fee among included transactions */
    minIncludedPriorityFee: bigint;
    /** Minimum priority fee among included blob transactions */
    minIncludedBlobPriorityFee: bigint;
}
/**
 * Complete fee analysis result comparing our estimates to what happened
 */
export interface L1FeeAnalysisResult {
    /** Unique identifier for this analysis */
    id: string;
    /** L2 slot number this analysis was performed for */
    l2SlotNumber: SlotNumber;
    /** Snapshot of pending state when we computed our fees */
    pendingSnapshot: PendingBlockSnapshot;
    /** Our computed gas prices */
    computedPrices: ComputedGasPrices;
    /** Information about what we were trying to send */
    txInfo: {
        requestCount: number;
        hasBlobData: boolean;
        totalEstimatedGas: bigint;
    };
    /** Information about the block that was eventually mined (populated after block mines) */
    minedBlock?: MinedBlockInfo;
    /** Analysis results (populated after block mines) */
    analysis?: {
        /** Time in ms between our snapshot and block mining */
        timeBeforeBlockMs: number;
        /** How many blob txs from pending actually got included */
        pendingBlobTxsIncludedCount: number;
        /** How many blob txs from pending were NOT included */
        pendingBlobTxsExcludedCount: number;
        /** Number of blobs in the mined block */
        blobsInBlock: number;
        /** Maximum blob capacity for this block */
        maxBlobCapacity: number;
        /** Whether the block's blob space was full */
        blockBlobsFull: boolean;
        /** Actual cost in ETH if this analysis is linked to a mined tx */
        actualCostEth?: number;
        /** Strategy results ranked by estimated cost */
        costRanking?: Array<{
            strategyId: string;
            strategyName: string;
            estimatedCostEth: number;
            wouldBeIncluded: boolean;
        }>;
    };
}
/** Callback type for when an analysis is completed */
export type L1FeeAnalysisCallback = (analysis: L1FeeAnalysisResult) => void;
/**
 * Analyzes L1 transaction fees in fisherman mode.
 * Captures pending block state, records gas calculations, and compares to what gets included.
 * Supports multiple priority fee calculation strategies for comparison.
 */
export declare class L1FeeAnalyzer {
    private client;
    private dateProvider;
    private logger;
    private maxCompletedAnalyses;
    private gasConfig;
    private pendingAnalyses;
    private pendingCallbacks;
    private completedAnalyses;
    private analysisCounter;
    private strategies;
    constructor(client: ViemClient, dateProvider?: DateProvider, logger?: Logger, maxCompletedAnalyses?: number, strategies?: PriorityFeeStrategy[], gasConfig?: L1TxUtilsConfig);
    /**
     * Executes all configured strategies and returns their results.
     * Each strategy handles its own RPC calls internally.
     * @param isBlobTx - Whether this is a blob transaction
     * @returns Array of strategy results
     */
    executeAllStrategies(isBlobTx: boolean): Promise<StrategyAnalysisResult[]>;
    /**
     * Captures a snapshot of the current pending block state
     */
    capturePendingSnapshot(): Promise<PendingBlockSnapshot>;
    /**
     * Starts a fee analysis for a transaction bundle
     * @param l2SlotNumber - The L2 slot this analysis is for
     * @param gasLimit - The estimated gas limit
     * @param requests - The transaction requests being analyzed
     * @param blobInputs - Blob inputs if this is a blob transaction
     * @param onComplete - Optional callback to invoke when analysis completes
     * @returns The analysis ID for tracking
     */
    startAnalysis(l2SlotNumber: SlotNumber, gasLimit: bigint, requests: L1TxRequest[], blobInputs?: L1BlobInputs, onComplete?: L1FeeAnalysisCallback): Promise<string>;
    private watchForNextBlock;
    /**
     * Completes the analysis once the next block is mined
     */
    private completeAnalysis;
    /**
     * Gets a specific analysis result by ID
     */
    getAnalysis(id: string): L1FeeAnalysisResult | undefined;
    /**
     * Gets all completed analyses
     */
    getCompletedAnalyses(): L1FeeAnalysisResult[];
    /**
     * Gets statistics about all completed analyses
     */
    getAnalysisStats(): {
        totalAnalyses: number;
        avgTimeBeforeBlockMs: number;
        avgBlobsInBlock: number;
        blocksBlobsFull: number;
    };
    /**
     * Gets comparative statistics for all strategies across completed analyses
     */
    getStrategyComparison(): Array<{
        strategyId: string;
        strategyName: string;
        totalAnalyses: number;
        inclusionCount: number;
        inclusionRate: number;
        avgEstimatedCostEth: number;
        totalEstimatedCostEth: number;
        avgOverpaymentEth: number;
        totalOverpaymentEth: number;
        avgPriorityFeeDeltaGwei: number;
    }>;
    /**
     * Gets the minimum value from an array of bigints
     */
    private minBigInt;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibDFfZmVlX2FuYWx5emVyLmQudHMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvbDFfdHhfdXRpbHMvbDFfZmVlX2FuYWx5emVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sS0FBSyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ2xFLE9BQU8sRUFBRSxLQUFLLE1BQU0sRUFBZ0IsTUFBTSx1QkFBdUIsQ0FBQztBQUVsRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFdkQsT0FBTyxFQUF5QyxLQUFLLEdBQUcsRUFBYyxNQUFNLE1BQU0sQ0FBQztBQUVuRixPQUFPLEtBQUssRUFBRSxVQUFVLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFOUMsT0FBTyxLQUFLLEVBQUUsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBRW5ELE9BQU8sRUFFTCxLQUFLLG1CQUFtQixFQUV6QixNQUFNLDJCQUEyQixDQUFDO0FBQ25DLE9BQU8sS0FBSyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFNUQ7O0dBRUc7QUFDSCxNQUFNLFdBQVcsVUFBVTtJQUN6QixJQUFJLEVBQUUsR0FBRyxDQUFDO0lBQ1Ysb0JBQW9CLEVBQUUsTUFBTSxDQUFDO0lBQzdCLFlBQVksRUFBRSxNQUFNLENBQUM7SUFDckIsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDO0lBQ3pCLFNBQVMsRUFBRSxNQUFNLENBQUM7SUFDbEIsR0FBRyxFQUFFLE1BQU0sQ0FBQztDQUNiO0FBRUQ7O0dBRUc7QUFDSCxNQUFNLFdBQVcsb0JBQW9CO0lBQ25DLDRDQUE0QztJQUM1QyxTQUFTLEVBQUUsTUFBTSxDQUFDO0lBQ2xCLHlEQUF5RDtJQUN6RCxpQkFBaUIsRUFBRSxNQUFNLENBQUM7SUFDMUIsMkNBQTJDO0lBQzNDLGFBQWEsRUFBRSxNQUFNLENBQUM7SUFDdEIsNENBQTRDO0lBQzVDLFdBQVcsRUFBRSxN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