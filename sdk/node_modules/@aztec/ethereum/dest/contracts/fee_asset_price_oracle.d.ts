import { EthAddress } from '@aztec/foundation/eth-address';
import { type Logger } from '@aztec/foundation/log';
import { type Hex } from 'viem';
import type { ViemClient } from '../types.js';
import { RollupContract } from './rollup.js';
/** Maximum price modifier per checkpoint in basis points. ±100 bps = ±1% */
export declare const MAX_FEE_ASSET_PRICE_MODIFIER_BPS = 100n;
/**
 * Validates that a fee asset price modifier is within the allowed range.
 * Validators should call this before attesting to a checkpoint proposal.
 *
 * @param modifier - The fee asset price modifier in basis points
 * @returns true if the modifier is valid (between -100 and +100 bps)
 */
export declare function validateFeeAssetPriceModifier(modifier: bigint): boolean;
/**
 * Oracle for computing fee asset price modifiers based on Uniswap V4 pool prices.
 * Only active on Ethereum mainnet - returns 0 on other chains.
 */
export declare class FeeAssetPriceOracle {
    private client;
    private readonly rollupContract;
    private log;
    constructor(client: ViemClient, rollupContract: RollupContract, log?: Logger);
    getUniswapOracle(): Promise<UniswapPriceOracle | undefined>;
    /**
     * Computes the fee asset price modifier to be used in the next checkpoint proposal.
     *
     * The modifier adjusts the on-chain fee asset price toward the oracle price,
     * clamped to ±1% (±100 basis points) per checkpoint.
     *
     * Returns 0 if not on mainnet or if the oracle query fails.
     *
     * @returns The price modifier in basis points (positive to increase price, negative to decrease)
     */
    computePriceModifier(): Promise<bigint>;
    /**
     * Gets the current oracle price (ETH per fee asset, scaled by 1e12).
     * Returns undefined if not on mainnet or if the oracle query fails.
     */
    getOraclePrice(): Promise<bigint | undefined>;
    /**
     * Computes the basis points modifier needed to move from current price toward target price.
     *
     * @param currentPrice - Current ETH per fee asset (E12 scale)
     * @param targetPrice - Target ETH per fee asset (E12 scale)
     * @returns Basis points modifier clamped to ±100 (±1%)
     */
    computePriceModifierBps(currentPrice: bigint, targetPrice: bigint): bigint;
}
/** Mainnet Uniswap V4 StateView contract address */
export declare const STATE_VIEW_ADDRESS: EthAddress;
/**
 * Converts Uniswap's sqrtPriceX96 directly to ETH per FeeAsset (E12).
 *
 * For an ETH/FeeAsset pool where ETH is currency0 and FeeAsset is currency1:
 * - Uniswap's sqrtPriceX96 = sqrt(FeeAsset/ETH) * 2^96
 * - We need: ETH/FeeAsset with 1e12 precision
 *
 * Math:
 *   price = (sqrtPriceX96 / 2^96)^2 = sqrtPriceX96^2 / 2^192  (FeeAsset per ETH)
 *   ethPerFeeAsset = 1 / price = 2^192 / sqrtPriceX96^2
 *   ethPerFeeAssetE12 = ethPerFeeAsset * 1e12 = 1e12 * 2^192 / sqrtPriceX96^2
 */
export declare function sqrtPriceX96ToEthPerFeeAssetE12(sqrtPriceX96: bigint): bigint;
/**
 * Client for querying the ETH/FeeAsset price from Uniswap V4.
 * Returns prices in ETH per FeeAsset format (E12) to match the rollup contract.
 */
declare class UniswapPriceOracle {
    private readonly client;
    private readonly stateView;
    private readonly poolId;
    private readonly log;
    constructor(client: ViemClient, log?: Logger);
    /**
     * Computes the PoolId from the pool configuration by hashing its components.
     * PoolId = keccak256(abi.encode(currency0, currency1, fee, tickSpacing, hooks))
     * For mainnet, the value is expected to be: 0xce2899b16743cfd5a954d8122d5e07f410305b1aebee39fd73d9f3b9ebf10c2f
     * Derived anyway to make it simpler to change if needed.
     */
    computePoolId(): Hex;
    isPoolInitialized(): Promise<boolean>;
    /**
     * Gets the price as ETH per FeeAsset, scaled by 1e12.
     * This is the format expected by the rollup contract.
     *
     * @param blockNumber - Optional block number to query at (defaults to latest)
     */
    getEthPerFeeAssetE12(blockNumber?: bigint): Promise<bigint>;
    /**
     * Gets the median price over the last N blocks as ETH per FeeAsset (E12).
     * Using median helps protect against single-block manipulation.
     *
     * @param numBlocks - Number of recent blocks to sample (default: 5)
     * @returns Median price as ETH per FeeAsset, scaled by 1e12
     */
    getMeanEthPerFeeAssetE12(numBlocks?: number): Promise<bigint>;
}
export {};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmVlX2Fzc2V0X3ByaWNlX29yYWNsZS5kLnRzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2NvbnRyYWN0cy9mZWVfYXNzZXRfcHJpY2Vfb3JhY2xlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUMzRCxPQUFPLEVBQUUsS0FBSyxNQUFNLEVBQWdCLE1BQU0sdUJBQXVCLENBQUM7QUFFbEUsT0FBTyxFQUFFLEtBQUssR0FBRyxFQUFtRSxNQUFNLE1BQU0sQ0FBQztBQUVqRyxPQUFPLEtBQUssRUFBRSxVQUFVLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDOUMsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUU3Qyw4RUFBNEU7QUFDNUUsZUFBTyxNQUFNLGdDQUFnQyxPQUFPLENBQUM7QUFFckQ7Ozs7OztHQU1HO0FBQ0gsd0JBQWdCLDZCQUE2QixDQUFDLFFBQVEsRUFBRSxNQUFNLEdBQUcsT0FBTyxDQUV2RTtBQUVEOzs7R0FHRztBQUNILHFCQUFhLG1CQUFtQjtJQUU1QixPQUFPLENBQUMsTUFBTTtJQUNkLE9BQU8sQ0FBQyxRQUFRLENBQUMsY0FBYztJQUMvQixPQUFPLENBQUMsR0FBRztJQUhiLFlBQ1UsTUFBTSxFQUFFLFVBQVUsRUFDVCxjQUFjLEVBQUUsY0FBYyxFQUN2QyxHQUFHLEdBQUUsTUFBK0MsRUFDMUQ7SUFHRSxnQkFBZ0IsSUFBSSxPQUFPLENBQUMsa0JBQWtCLEdBQUcsU0FBUyxDQUFDLENBb0JoRTtJQUVEOzs7Ozs7Ozs7T0FTRztJQUNHLG9CQUFvQixJQUFJLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0EyQjVDO0lBRUQ7OztPQUdHO0lBQ0csY0FBYyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsU0FBUyxDQUFDLENBWWxEO0lBRUQ7Ozs7OztPQU1HO0lBQ0gsdUJBQXVCLENBQUMsWUFBWSxFQUFFLE1BQU0sRUFBRSxXQUFXLEVBQUUsTUFBTSxHQUFHLE1BQU0sQ0FrQnpFO0NBQ0Y7QUFFRCxvREFBb0Q7QUFDcEQsZUFBTyxNQUFNLGtCQUFrQixZQUFzRSxDQUFDO0FBSXRHOzs7Ozs7Ozs7OztHQVdHO0FBQ0gsd0JBQWdCLCtCQUErQixDQUFDLFlBQVksRUFBRSxNQUFNLEdBQUcsTUFBTSxDQUs1RTtBQW1CRDs7O0dBR0c7QUFDSCxjQUFNLGtCQUFrQjtJQU1wQixPQUFPLENBQUMsUUFBUSxDQUFDLE1BQU07SUFMekIsT0FBTyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUM7SUFDM0IsT0FBTyxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQU07SUFDN0IsT0FBTyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQVM7SUFFN0IsWUFDbUIsTUFBTSxFQUFFLFVBQVUsRUFDbkMsR0FBRyxDQUFDLEVBQUUsTUFBTSxFQVViO0lBRUQ7Ozs7O09BS0c7SUFFSCxhQUFhLElBQUksR0FBRyxDQVVuQjtJQUVLLGlCQUFpQixJQUFJLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FHMUM7SUFFRDs7Ozs7T0FLRztJQUNHLG9CQUFvQixDQUFDLFdBQVcsQ0FBQyxFQUFFLE1BQU0sR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBTWhFO0lBRUQ7Ozs7OztPQU1HO0lBQ0csd0JBQXdCLENBQUMsU0FBUyxHQUFFLE1BQVUsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLENBMkJyRTtDQUNGIn0=