import { LmdbAztecMap } from './map.js';
/**
 * A map backed by LMDB.
 */ export class LmdbAztecMultiMap extends LmdbAztecMap {
    *getValues(key) {
        const transaction = this.db.useReadTransaction();
        try {
            const values = this.db.getValues(this.slot(key), {
                transaction
            });
            for (const value of values){
                yield value?.[1];
            }
        } finally{
            transaction.done();
        }
    }
    async *getValuesAsync(key) {
        for (const value of this.getValues(key)){
            yield value;
        }
    }
    getValueCountAsync(key) {
        const transaction = this.db.useReadTransaction();
        try {
            const values = this.db.getValues(this.slot(key), {
                transaction
            });
            let count = 0;
            for (const _ of values){
                count++;
            }
            return Promise.resolve(count);
        } finally{
            transaction.done();
        }
    }
    async deleteValue(key, val) {
        await this.db.remove(this.slot(key), [
            key,
            val
        ]);
    }
}
