import { Encoder } from 'msgpackr';
import { execInReadTx, execInWriteTx } from './tx-helpers.js';
import { serializeKey } from './utils.js';
export class LMDBSingleValue {
    store;
    key;
    encoder;
    constructor(store, name){
        this.store = store;
        this.encoder = new Encoder();
        this.key = serializeKey(`singleton:${name}`, 'value');
    }
    getAsync() {
        return execInReadTx(this.store, async (tx)=>{
            const val = await tx.get(this.key);
            return val ? this.encoder.unpack(val) : undefined;
        });
    }
    set(val) {
        return execInWriteTx(this.store, async (tx)=>{
            await tx.set(this.key, this.encoder.pack(val));
            return true;
        });
    }
    delete() {
        return execInWriteTx(this.store, async (tx)=>{
            await tx.remove(this.key);
            return true;
        });
    }
}
