import { UPDATED_CLASS_IDS_SLOT } from '@aztec/constants';
import { Fr } from '@aztec/foundation/curves/bn254';
import { deriveStorageSlotInMap } from '../hash/map_slot.js';
import { DELAYED_PUBLIC_MUTABLE_VALUES_LEN, DelayedPublicMutableValues } from './delayed_public_mutable_values.js';
export class DelayedPublicMutableValuesWithHash {
    dpmv;
    constructor(svc, sdc){
        this.dpmv = new DelayedPublicMutableValues(svc, sdc);
    }
    async toFields() {
        return [
            ...this.dpmv.toFields(),
            await this.dpmv.hash()
        ];
    }
    async writeToTree(delayedPublicMutableSlot, storageWrite) {
        const fields = await this.toFields();
        for(let i = 0; i < fields.length; i++){
            await storageWrite(delayedPublicMutableSlot.add(new Fr(i)), fields[i]);
        }
    }
    static async getContractUpdateSlots(contractAddress) {
        const delayedPublicMutableSlot = await deriveStorageSlotInMap(new Fr(UPDATED_CLASS_IDS_SLOT), contractAddress);
        const delayedPublicMutableHashSlot = delayedPublicMutableSlot.add(new Fr(DELAYED_PUBLIC_MUTABLE_VALUES_LEN));
        return {
            delayedPublicMutableSlot,
            delayedPublicMutableHashSlot
        };
    }
}
