import { Fr } from '@aztec/foundation/curves/bn254';
import { computePublicDataTreeLeafSlot } from '../hash/hash.js';
import { MerkleTreeId } from './merkle_tree_id.js';
export class DatabasePublicStateSource {
    db;
    constructor(db){
        this.db = db;
    }
    async storageRead(contractAddress, slot) {
        const leafSlot = (await computePublicDataTreeLeafSlot(contractAddress, slot)).toBigInt();
        const lowLeafResult = await this.db.getPreviousValueIndex(MerkleTreeId.PUBLIC_DATA_TREE, leafSlot);
        if (!lowLeafResult || !lowLeafResult.alreadyPresent) {
            return Fr.ZERO;
        }
        const preimage = await this.db.getLeafPreimage(MerkleTreeId.PUBLIC_DATA_TREE, lowLeafResult.index);
        return preimage.leaf.value;
    }
}
