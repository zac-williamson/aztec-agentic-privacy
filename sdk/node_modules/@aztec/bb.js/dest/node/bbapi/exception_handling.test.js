import { BarretenbergWasmSyncBackend } from '../bb_backends/wasm.js';
import { SyncApi } from '../cbind/generated/sync.js';
describe('BBApi Exception Handling from bb.js', () => {
    let backend;
    let api;
    beforeAll(async () => {
        backend = await BarretenbergWasmSyncBackend.new();
        api = new SyncApi(backend);
    }, 60000);
    afterAll(() => {
        backend.destroy();
    });
    it('should catch CRS initialization exceptions from WASM', () => {
        // Create an SrsInitSrs command with invalid data that will cause an exception in C++
        // We pass buffers that are too small, which will cause validation to fail
        const invalidCommand = {
            numPoints: 100, // Request 100 points (requires 6400 bytes)
            pointsBuf: new Uint8Array(10), // Only 10 bytes - will cause exception
            g2Point: new Uint8Array(10), // Only 10 bytes (needs 128) - will cause exception
        };
        // In WASM builds, throw_or_abort calls abort directly which throws a generic Error
        // In native builds with exceptions, our try-catch in bbapi converts it to ErrorResponse
        // This test verifies that errors are catchable from bb.js (even if as generic Error in WASM)
        expect(() => {
            api.srsInitSrs(invalidCommand);
        }).toThrow();
    });
    it('should return error message from caught exception', () => {
        const invalidCommand = {
            numPoints: 100,
            pointsBuf: new Uint8Array(10),
            g2Point: new Uint8Array(10),
        };
        try {
            api.srsInitSrs(invalidCommand);
            fail('Expected exception to be thrown');
        }
        catch (error) {
            // Error is catchable and contains a useful message
            expect(error).toBeInstanceOf(Error);
            expect(error.message).toBeTruthy();
            expect(error.message.length).toBeGreaterThan(0);
            expect(error.message).toContain('g1_identity');
            console.log('Successfully caught exception from bb.js with message:', error.message);
        }
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX2hhbmRsaW5nLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYmJhcGkvZXhjZXB0aW9uX2hhbmRsaW5nLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLDJCQUEyQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDckUsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBR3JELFFBQVEsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNwRCxJQUFJLE9BQW9DLENBQUM7SUFDekMsSUFBSSxHQUFZLENBQUM7SUFFakIsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDcEIsT0FBTyxHQUFHLE1BQU0sMkJBQTJCLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDbEQsR0FBRyxHQUFHLElBQUksT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQUEsQ0FDNUIsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUVWLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUNiLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUFBLENBQ25CLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxzREFBc0QsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUMvRCxxRkFBcUY7UUFDckYsMEVBQTBFO1FBQzFFLE1BQU0sY0FBYyxHQUFHO1lBQ3JCLFNBQVMsRUFBRSxHQUFHLEVBQUUsMkNBQTJDO1lBQzNELFNBQVMsRUFBRSxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSx1Q0FBdUM7WUFDdEUsT0FBTyxFQUFFLElBQUksVUFBVSxDQUFDLEVBQUUsQ0FBQyxFQUFFLG1EQUFtRDtTQUNqRixDQUFDO1FBRUYsbUZBQW1GO1FBQ25GLHdGQUF3RjtRQUN4Riw2RkFBNkY7UUFDN0YsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ1gsR0FBRyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUFBLENBQ2hDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztJQUFBLENBQ2QsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLG1EQUFtRCxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQzVELE1BQU0sY0FBYyxHQUFHO1lBQ3JCLFNBQVMsRUFBRSxHQUFHO1lBQ2QsU0FBUyxFQUFFLElBQUksVUFBVSxDQUFDLEVBQUUsQ0FBQztZQUM3QixPQUFPLEVBQUUsSUFBSSxVQUFVLENBQUMsRUFBRSxDQUFDO1NBQzVCLENBQUM7UUFFRixJQUFJLENBQUM7WUFDSCxHQUFHLENBQUMsVUFBVSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQy9CLElBQUksQ0FBQyxpQ0FBaUMsQ0FBQyxDQUFDO1FBQzFDLENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsbURBQW1EO1lBQ25ELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFFLEtBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUM5QyxNQUFNLENBQUUsS0FBZSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDM0QsTUFBTSxDQUFFLEtBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3REFBd0QsRUFBRyxLQUFlLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDbEcsQ0FBQztJQUFBLENBQ0YsQ0FBQyxDQUFDO0FBQUEsQ0FDSixDQUFDLENBQUMifQ==