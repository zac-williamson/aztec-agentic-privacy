"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Fr = void 0;
const index_js_1 = require("../../random/index.js");
const bigint_buffer_js_1 = require("./bigint-buffer.js");
class Fr {
    static ZERO = new Fr(0n);
    static MODULUS = 0x30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f0000001n;
    static MAX_VALUE = this.MODULUS - 1n;
    static SIZE_IN_BYTES = 32;
    value;
    constructor(value) {
        // We convert buffer value to bigint to be able to check it fits within modulus
        const valueBigInt = typeof value === 'bigint'
            ? value
            : value instanceof Buffer
                ? (0, bigint_buffer_js_1.buffer32BytesToBigIntBE)(value)
                : (0, bigint_buffer_js_1.uint8ArrayToBigIntBE)(value);
        if (valueBigInt > Fr.MAX_VALUE) {
            throw new Error(`Value 0x${valueBigInt.toString(16)} is greater or equal to field modulus.`);
        }
        this.value =
            typeof value === 'bigint' ? (0, bigint_buffer_js_1.bigIntToUint8ArrayBE)(value) : value instanceof Buffer ? new Uint8Array(value) : value;
    }
    static random() {
        const r = (0, bigint_buffer_js_1.uint8ArrayToBigIntBE)((0, index_js_1.randomBytes)(64)) % Fr.MODULUS;
        return new this(r);
    }
    toBuffer() {
        return this.value;
    }
    toString() {
        return '0x' + this.toBuffer().reduce((accumulator, byte) => accumulator + byte.toString(16).padStart(2, '0'), '');
    }
    equals(rhs) {
        return this.value.every((v, i) => v === rhs.value[i]);
    }
    isZero() {
        return this.value.every(v => v === 0);
    }
    static fromBuffer(value) {
        return Fr.fromBufferReduce(value);
    }
    static fromBufferReduce(value) {
        const valueBigInt = (0, bigint_buffer_js_1.uint8ArrayToBigIntBE)(value);
        const reducedValue = valueBigInt % Fr.MODULUS;
        return new Fr(reducedValue);
    }
}
exports.Fr = Fr;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmllbGRzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL2JhcnJldGVuYmVyZy90ZXN0aW5nL2ZpZWxkcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxvREFBb0Q7QUFDcEQseURBSzRCO0FBRTVCO0lBQ0UsTUFBTSxDQUFDLElBQUksR0FBRyxJQUFJLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUN6QixNQUFNLENBQUMsT0FBTyxHQUFHLG1FQUFtRSxDQUFDO0lBQ3JGLE1BQU0sQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLENBQUM7SUFDckMsTUFBTSxDQUFDLGFBQWEsR0FBRyxFQUFFLENBQUM7SUFDMUIsS0FBSyxDQUFhO0lBRWxCLFlBQVksS0FBbUMsRUFBRTtRQUMvQywrRUFBK0U7UUFDL0UsTUFBTSxXQUFXLEdBQ2YsT0FBTyxLQUFLLEtBQUssUUFBUTtZQUN2QixDQUFDLENBQUMsS0FBSztZQUNQLENBQUMsQ0FBQyxLQUFLLFlBQVksTUFBTTtnQkFDdkIsQ0FBQyxDQUFDLElBQUEsMENBQXVCLEVBQUMsS0FBSyxDQUFDO2dCQUNoQyxDQUFDLENBQUMsSUFBQSx1Q0FBb0IsRUFBQyxLQUFLLENBQUMsQ0FBQztRQUVwQyxJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDL0IsTUFBTSxJQUFJLEtBQUssQ0FBQyxXQUFXLFdBQVcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLHdDQUF3QyxDQUFDLENBQUM7UUFDL0YsQ0FBQztRQUVELElBQUksQ0FBQyxLQUFLO1lBQ1IsT0FBTyxLQUFLLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFBLHVDQUFvQixFQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLFlBQVksTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQUEsQ0FDckg7SUFFRCxNQUFNLENBQUMsTUFBTSxHQUFHO1FBQ2QsTUFBTSxDQUFDLEdBQUcsSUFBQSx1Q0FBb0IsRUFBQyxJQUFBLHNCQUFXLEVBQUMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDO1FBQzdELE9BQU8sSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFBQSxDQUNwQjtJQUVELFFBQVEsR0FBRztRQUNULE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQztJQUFBLENBQ25CO0lBRUQsUUFBUSxHQUFHO1FBQ1QsT0FBTyxJQUFJLEdBQUcsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFBQSxDQUNuSDtJQUVELE1BQU0sQ0FBQyxHQUFPLEVBQUU7UUFDZCxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxLQUFLLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUFBLENBQ3ZEO0lBRUQsTUFBTSxHQUFHO1FBQ1AsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUFBLENBQ3ZDO0lBRUQsTUFBTSxDQUFDLFVBQVUsQ0FBQyxLQUFpQixFQUFNO1FBQ3ZDLE9BQU8sRUFBRSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQUEsQ0FDbkM7SUFFRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsS0FBaUIsRUFBTTtRQUM3QyxNQUFNLFdBQVcsR0FBRyxJQUFBLHVDQUFvQixFQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hELE1BQU0sWUFBWSxHQUFHLFdBQVcsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDO1FBQzlDLE9BQU8sSUFBSSxFQUFFLENBQUMsWUFBWSxDQUFDLENBQUM7SUFBQSxDQUM3QjtDQUNGIn0=