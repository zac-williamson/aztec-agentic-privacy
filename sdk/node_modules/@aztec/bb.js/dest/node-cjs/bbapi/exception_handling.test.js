"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const wasm_js_1 = require("../bb_backends/wasm.js");
const sync_js_1 = require("../cbind/generated/sync.js");
describe('BBApi Exception Handling from bb.js', () => {
    let backend;
    let api;
    beforeAll(async () => {
        backend = await wasm_js_1.BarretenbergWasmSyncBackend.new();
        api = new sync_js_1.SyncApi(backend);
    }, 60000);
    afterAll(() => {
        backend.destroy();
    });
    it('should catch CRS initialization exceptions from WASM', () => {
        // Create an SrsInitSrs command with invalid data that will cause an exception in C++
        // We pass buffers that are too small, which will cause validation to fail
        const invalidCommand = {
            numPoints: 100, // Request 100 points (requires 6400 bytes)
            pointsBuf: new Uint8Array(10), // Only 10 bytes - will cause exception
            g2Point: new Uint8Array(10), // Only 10 bytes (needs 128) - will cause exception
        };
        // In WASM builds, throw_or_abort calls abort directly which throws a generic Error
        // In native builds with exceptions, our try-catch in bbapi converts it to ErrorResponse
        // This test verifies that errors are catchable from bb.js (even if as generic Error in WASM)
        expect(() => {
            api.srsInitSrs(invalidCommand);
        }).toThrow();
    });
    it('should return error message from caught exception', () => {
        const invalidCommand = {
            numPoints: 100,
            pointsBuf: new Uint8Array(10),
            g2Point: new Uint8Array(10),
        };
        try {
            api.srsInitSrs(invalidCommand);
            fail('Expected exception to be thrown');
        }
        catch (error) {
            // Error is catchable and contains a useful message
            expect(error).toBeInstanceOf(Error);
            expect(error.message).toBeTruthy();
            expect(error.message.length).toBeGreaterThan(0);
            expect(error.message).toContain('g1_identity');
            console.log('Successfully caught exception from bb.js with message:', error.message);
        }
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhjZXB0aW9uX2hhbmRsaW5nLnRlc3QuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYmJhcGkvZXhjZXB0aW9uX2hhbmRsaW5nLnRlc3QudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxvREFBcUU7QUFDckUsd0RBQXFEO0FBR3JELFFBQVEsQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUUsQ0FBQztJQUNwRCxJQUFJLE9BQW9DLENBQUM7SUFDekMsSUFBSSxHQUFZLENBQUM7SUFFakIsU0FBUyxDQUFDLEtBQUssSUFBSSxFQUFFLENBQUM7UUFDcEIsT0FBTyxHQUFHLE1BQU0scUNBQTJCLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDbEQsR0FBRyxHQUFHLElBQUksaUJBQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUFBLENBQzVCLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFVixRQUFRLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDYixPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7SUFBQSxDQUNuQixDQUFDLENBQUM7SUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFLENBQUM7UUFDL0QscUZBQXFGO1FBQ3JGLDBFQUEwRTtRQUMxRSxNQUFNLGNBQWMsR0FBRztZQUNyQixTQUFTLEVBQUUsR0FBRyxFQUFFLDJDQUEyQztZQUMzRCxTQUFTLEVBQUUsSUFBSSxVQUFVLENBQUMsRUFBRSxDQUFDLEVBQUUsdUNBQXVDO1lBQ3RFLE9BQU8sRUFBRSxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxtREFBbUQ7U0FDakYsQ0FBQztRQUVGLG1GQUFtRjtRQUNuRix3RkFBd0Y7UUFDeEYsNkZBQTZGO1FBQzdGLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNYLEdBQUcsQ0FBQyxVQUFVLENBQUMsY0FBYyxDQUFDLENBQUM7UUFBQSxDQUNoQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUM7SUFBQSxDQUNkLENBQUMsQ0FBQztJQUVILEVBQUUsQ0FBQyxtREFBbUQsRUFBRSxHQUFHLEVBQUUsQ0FBQztRQUM1RCxNQUFNLGNBQWMsR0FBRztZQUNyQixTQUFTLEVBQUUsR0FBRztZQUNkLFNBQVMsRUFBRSxJQUFJLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDN0IsT0FBTyxFQUFFLElBQUksVUFBVSxDQUFDLEVBQUUsQ0FBQztTQUM1QixDQUFDO1FBRUYsSUFBSSxDQUFDO1lBQ0gsR0FBRyxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMvQixJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztRQUMxQyxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLG1EQUFtRDtZQUNuRCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBRSxLQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDOUMsTUFBTSxDQUFFLEtBQWUsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBRSxLQUFlLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzFELE9BQU8sQ0FBQyxHQUFHLENBQUMsd0RBQXdELEVBQUcsS0FBZSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2xHLENBQUM7SUFBQSxDQUNGLENBQUMsQ0FBQztBQUFBLENBQ0osQ0FBQyxDQUFDIn0=