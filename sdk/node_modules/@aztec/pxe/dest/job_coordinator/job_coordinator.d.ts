import { type LoggerBindings } from '@aztec/foundation/log';
import type { AztecAsyncKVStore } from '@aztec/kv-store';
/**
 * Interface that stores must implement to support staged writes.
 */
export interface StagedStore {
    /** Unique name identifying this store (used for tracking staged stores from JobCoordinator) */
    readonly storeName: string;
    /**
     * Commits staged data to main storage.
     * Should be called within a transaction for atomicity.
     *
     * @param jobId - The job identifier
     */
    commit(jobId: string): Promise<void>;
    /**
     * Discards staged data without committing.
     * Called on abort.
     *
     * @param jobId - The job identifier
     */
    discardStaged(jobId: string): Promise<void>;
}
/**
 * JobCoordinator manages job lifecycle and provides crash resilience for PXE operations.
 *
 * It uses a staged writes pattern:
 * 1. When a job begins, a unique job ID is created
 * 2. During the job, all writes go to staging (keyed by job ID)
 * 3. On commit, staging is promoted to main storage
 * 4. On abort, staged data is discarded
 *
 * Note: PXE should only rely on a single JobCoordinator instance, so it can eventually
 * orchestrate concurrent jobs. Right now it doesn't make a difference because we're
 * using a job queue with concurrency=1.
 */
export declare class JobCoordinator {
    #private;
    private readonly log;
    /** The underlying KV store */
    kvStore: AztecAsyncKVStore;
    constructor(kvStore: AztecAsyncKVStore, bindings?: LoggerBindings);
    /**
     * Registers a staged store.
     * Must be called during initialization for all stores that need staging support.
     */
    registerStore(store: StagedStore): void;
    /**
     * Registers multiple staged stores.
     */
    registerStores(stores: StagedStore[]): void;
    /**
     * Begins a new job and returns a job ID for staged writes.
     *
     * @returns Job ID to pass to store operations
     */
    beginJob(): string;
    /**
     * Commits a job by promoting all staged data to main storage.
     *
     * @param jobId - The job ID returned from beginJob
     */
    commitJob(jobId: string): Promise<void>;
    /**
     * Aborts a job by discarding all staged data.
     *
     * @param jobId - The job ID returned from beginJob
     */
    abortJob(jobId: string): Promise<void>;
    /**
     * Checks if there's a job currently in progress.
     */
    hasJobInProgress(): boolean;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiam9iX2Nvb3JkaW5hdG9yLmQudHMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvam9iX2Nvb3JkaW5hdG9yL2pvYl9jb29yZGluYXRvci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEVBQWUsS0FBSyxjQUFjLEVBQWdCLE1BQU0sdUJBQXVCLENBQUM7QUFDdkYsT0FBTyxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUV6RDs7R0FFRztBQUNILE1BQU0sV0FBVyxXQUFXO0lBQzFCLCtGQUErRjtJQUMvRixRQUFRLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQztJQUUzQjs7Ozs7T0FLRztJQUNILE1BQU0sQ0FBQyxLQUFLLEVBQUUsTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUVyQzs7Ozs7T0FLRztJQUNILGFBQWEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztDQUM3QztBQUVEOzs7Ozs7Ozs7Ozs7R0FZRztBQUNILHFCQUFhLGNBQWM7O0lBQ3pCLE9BQU8sQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFTO0lBRTdCLDhCQUE4QjtJQUM5QixPQUFPLEVBQUUsaUJBQWlCLENBQUM7SUFLM0IsWUFBWSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLEVBQUUsY0FBYyxFQUdoRTtJQUVEOzs7T0FHRztJQUNILGFBQWEsQ0FBQyxLQUFLLEVBQUUsV0FBVyxHQUFHLElBQUksQ0FNdEM7SUFFRDs7T0FFRztJQUNILGNBQWMsQ0FBQyxNQUFNLEVBQUUsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUkxQztJQUVEOzs7O09BSUc7SUFDSCxRQUFRLElBQUksTUFBTSxDQWFqQjtJQUVEOzs7O09BSUc7SUFDRyxTQUFTLENBQUMsS0FBSyxFQUFFLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBbUI1QztJQUVEOzs7O09BSUc7SUFDRyxRQUFRLENBQUMsS0FBSyxFQUFFLE1BQU0sR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBYzNDO0lBRUQ7O09BRUc7SUFDSCxnQkFBZ0IsSUFBSSxPQUFPLENBRTFCO0NBQ0YifQ==