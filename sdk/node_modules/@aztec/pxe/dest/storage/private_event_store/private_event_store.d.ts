import { Fr } from '@aztec/foundation/curves/bn254';
import type { AztecAsyncKVStore } from '@aztec/kv-store';
import type { EventSelector } from '@aztec/stdlib/abi';
import type { AztecAddress } from '@aztec/stdlib/aztec-address';
import type { InTx, TxHash } from '@aztec/stdlib/tx';
import type { StagedStore } from '../../job_coordinator/job_coordinator.js';
import type { PackedPrivateEvent } from '../../pxe.js';
export type PrivateEventStoreFilter = {
    contractAddress: AztecAddress;
    fromBlock: number;
    toBlock: number;
    scopes: AztecAddress[];
    txHash?: TxHash;
};
type PrivateEventMetadata = InTx & {
    contractAddress: AztecAddress;
    scope: AztecAddress;
    /** The index of the tx within the block */
    txIndexInBlock: number;
    /** The index of the event within the tx (based on nullifier position) */
    eventIndexInTx: number;
};
/**
 * Stores decrypted private event logs.
 */
export declare class PrivateEventStore implements StagedStore {
    #private;
    readonly storeName: string;
    logger: import("@aztec/foundation/log").Logger;
    constructor(store: AztecAsyncKVStore);
    /**
     * Store a private event log.
     * @param eventSelector - The event selector of the event.
     * @param randomness - The randomness used for the event commitment.
     * @param msgContent - The content of the event.
     * @param siloedEventCommitment - The siloed event commitment (used as unique identifier).
     * @param metadata
     *  contractAddress - The address of the contract that emitted the event.
     *  scope - The address to which the event is scoped.
     *  txHash - The transaction hash of the event log.
     *  blockNumber - The block number in which the event was emitted.
     */
    storePrivateEventLog(eventSelector: EventSelector, randomness: Fr, msgContent: Fr[], siloedEventCommitment: Fr, metadata: PrivateEventMetadata, jobId: string): Promise<void>;
    /**
     * Returns the private events given search parameters.
     * @param eventSelector - The event selector to filter by.
     * @param filter - Filtering criteria:
     *  contractAddress: The address of the contract to get events from.
     *  fromBlock: The block number to search from (inclusive).
     *  toBlock: The block number to search upto (exclusive).
     *  scope: - The addresses that decrypted the logs.
     * @returns - The event log contents, augmented with metadata about the transaction and block in which the event was
     * included.
     */
    getPrivateEvents(eventSelector: EventSelector, filter: PrivateEventStoreFilter): Promise<PackedPrivateEvent[]>;
    /**
     * Rolls back private events that were stored after a given `blockNumber` and up to `synchedBlockNumber` (the block
     * number up to which PXE managed to sync before the reorg happened).
     *
     * We don't need staged writes for a rollback since it's handled in the context of a blockchain rewind.
     *
     * Rollbacks are handled by the BlockSynchronizer, which runs a DB transaction across stores when it detects a
     * re-org, including setting the new anchor block after rolling back.
     *
     * So if anything fails in the process of rolling back any store, all DB changes occurring during rollbacks will be
     * lost and the anchor block will not be updated; which means this code will eventually need to run again
     * (i.e.: PXE will detect it's basing it work on an invalid block hash, then which re-triggers rewind).
     *
     * For further details, refer to `BlockSynchronizer#handleBlockStreamEvent`.
     *
     * IMPORTANT: This method must be called within a transaction to ensure atomicity.
     */
    rollback(blockNumber: number, synchedBlockNumber: number): Promise<void>;
    /**
     * Commits in memory job data to persistent storage.
     *
     * Called by JobCoordinator when a job completes successfully.
     *
     * Note: JobCoordinator wraps all commits in a single transaction, so we don't need our own transactionAsync here
     * (and using one would throw on IndexedDB as it does not support nested txs).
     *
     * @param jobId - The jobId identifying which staged data to commit
     */
    commit(jobId: string): Promise<void>;
    /**
     * Discards in memory job data without persisting it.
     */
    discardStaged(jobId: string): Promise<void>;
}
export {};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJpdmF0ZV9ldmVudF9zdG9yZS5kLnRzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3N0b3JhZ2UvcHJpdmF0ZV9ldmVudF9zdG9yZS9wcml2YXRlX2V2ZW50X3N0b3JlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxFQUFFLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUdwRCxPQUFPLEtBQUssRUFBRSxpQkFBaUIsRUFBcUMsTUFBTSxpQkFBaUIsQ0FBQztBQUM1RixPQUFPLEtBQUssRUFBRSxhQUFhLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUN2RCxPQUFPLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUNoRSxPQUFPLEtBQUssRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE1BQU0sa0JBQWtCLENBQUM7QUFFckQsT0FBTyxLQUFLLEVBQUUsV0FBVyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFDNUUsT0FBTyxLQUFLLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxjQUFjLENBQUM7QUFHdkQsTUFBTSxNQUFNLHVCQUF1QixHQUFHO0lBQ3BDLGVBQWUsRUFBRSxZQUFZLENBQUM7SUFDOUIsU0FBUyxFQUFFLE1BQU0sQ0FBQztJQUNsQixPQUFPLEVBQUUsTUFBTSxDQUFDO0lBQ2hCLE1BQU0sRUFBRSxZQUFZLEVBQUUsQ0FBQztJQUN2QixNQUFNLENBQUMsRUFBRSxNQUFNLENBQUM7Q0FDakIsQ0FBQztBQUVGLEtBQUssb0JBQW9CLEdBQUcsSUFBSSxHQUFHO0lBQ2pDLGVBQWUsRUFBRSxZQUFZLENBQUM7SUFDOUIsS0FBSyxFQUFFLFlBQVksQ0FBQztJQUNwQiwyQ0FBMkM7SUFDM0MsY0FBYyxFQUFFLE1BQU0sQ0FBQztJQUN2Qix5RUFBeUU7SUFDekUsY0FBYyxFQUFFLE1BQU0sQ0FBQztDQUN4QixDQUFDO0FBRUY7O0dBRUc7QUFDSCxxQkFBYSxpQkFBa0IsWUFBVyxXQUFXOztJQUNuRCxRQUFRLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBbUI7SUFnQjdDLE1BQU0seUNBQXVDO0lBRTdDLFlBQVksS0FBSyxFQUFFLGlCQUFpQixFQVFuQztJQUVEOzs7Ozs7Ozs7OztPQVdHO0lBQ0gsb0JBQW9CLENBQ2xCLGFBQWEsRUFBRSxhQUFhLEVBQzVCLFVBQVUsRUFBRSxFQUFFLEVBQ2QsVUFBVSxFQUFFLEVBQUUsRUFBRSxFQUNoQixxQkFBcUIsRUFBRSxFQUFFLEVBQ3pCLFFBQVEsRUFBRSxvQkFBb0IsRUFDOUIsS0FBSyxFQUFFLE1BQU0saUJBeUNkO0lBRUQ7Ozs7Ozs7Ozs7T0FVRztJQUNJLGdCQUFnQixDQUNyQixhQUFhLEVBQUUsYUFBYSxFQUM1QixNQUFNLEVBQUUsdUJBQXVCLEdBQzlCLE9BQU8sQ0FBQyxrQkFBa0IsRUFBRSxDQUFDLENBK0UvQjtJQUVEOzs7Ozs7Ozs7Ozs7Ozs7O09BZ0JHO0lBQ1UsUUFBUSxDQUFDLFdBQVcsRUFBRSxNQUFNLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FzQ3BGO0lBRUQ7Ozs7Ozs7OztPQVNHO0lBQ0csTUFBTSxDQUFDLEtBQUssRUFBRSxNQUFNLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQWdCekM7SUFFRDs7T0FFRztJQUNILGFBQWEsQ0FBQyxLQUFLLEVBQUUsTUFBTSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FHMUM7Q0EwRUYifQ==