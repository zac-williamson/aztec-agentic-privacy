import { Fr } from '@aztec/foundation/curves/bn254';
import { type LogLevel, type Logger, type LoggerBindings } from '@aztec/foundation/log';
import { PublicDataUpdateRequest } from '@aztec/stdlib/avm';
import type { AztecAddress } from '@aztec/stdlib/aztec-address';
import { NoteHash, Nullifier } from '@aztec/stdlib/kernel';
import { DebugLog, PublicLog } from '@aztec/stdlib/logs';
import { ScopedL2ToL1Message } from '@aztec/stdlib/messaging';
import type { PublicSideEffectTraceInterface } from './side_effect_trace_interface.js';
import { UniqueClassIds } from './unique_class_ids.js';
/**
 * A struct containing just the side effects as regular arrays
 * as opposed to "Tuple" arrays used by circuit public inputs.
 * This struct is helpful for testing and checking array lengths.
 **/
export type SideEffects = {
    publicDataWrites: PublicDataUpdateRequest[];
    noteHashes: NoteHash[];
    nullifiers: Nullifier[];
    l2ToL1Msgs: ScopedL2ToL1Message[];
    publicLogs: PublicLog[];
};
export declare class SideEffectArrayLengths {
    readonly publicDataWrites: number;
    readonly protocolPublicDataWrites: number;
    readonly noteHashes: number;
    readonly nullifiers: number;
    readonly l2ToL1Msgs: number;
    readonly publicLogFields: number;
    constructor(publicDataWrites: number, protocolPublicDataWrites: number, noteHashes: number, nullifiers: number, l2ToL1Msgs: number, publicLogFields: number);
    static empty(): SideEffectArrayLengths;
}
/**
 * Trace side effects for an enqueued public call's execution.
 */
export declare class SideEffectTrace implements PublicSideEffectTraceInterface {
    /** The counter of this trace's first side effect. */
    readonly startSideEffectCounter: number;
    /** Track parent's (or previous kernel's) lengths so the AVM can properly enforce TX-wide limits,
     *  otherwise the public kernel can fail to prove because TX limits are breached.
     */
    private readonly previousSideEffectArrayLengths;
    /** We need to track the set of class IDs used, to enforce limits. */
    private uniqueClassIds;
    private writtenPublicDataSlots;
    private debugLogs;
    private debugLogMemoryReads;
    log: Logger;
    /** The side effect counter increments with every call to the trace. */
    private sideEffectCounter;
    private publicDataWrites;
    private protocolPublicDataWritesLength;
    private userPublicDataWritesLength;
    private noteHashes;
    private nullifiers;
    private l2ToL1Messages;
    private publicLogs;
    /** Make sure a forked trace is never merged twice. */
    private alreadyMergedIntoParent;
    constructor(
    /** The counter of this trace's first side effect. */
    startSideEffectCounter?: number, bindings?: LoggerBindings, 
    /** Track parent's (or previous kernel's) lengths so the AVM can properly enforce TX-wide limits,
     *  otherwise the public kernel can fail to prove because TX limits are breached.
     */
    previousSideEffectArrayLengths?: SideEffectArrayLengths, 
    /** We need to track the set of class IDs used, to enforce limits. */
    uniqueClassIds?: UniqueClassIds, writtenPublicDataSlots?: Set<string>, debugLogs?: DebugLog[], debugLogMemoryReads?: number);
    fork(): SideEffectTrace;
    merge(forkedTrace: this, reverted?: boolean): void;
    getCounter(): number;
    private incrementSideEffectCounter;
    getNoteHashCount(): number;
    tracePublicStorageWrite(contractAddress: AztecAddress, slot: Fr, value: Fr, protocolWrite: boolean): Promise<void>;
    private computePublicDataSlotKey;
    isStorageCold(contractAddress: AztecAddress, slot: Fr): boolean;
    traceNewNoteHash(noteHash: Fr): void;
    traceNewNullifier(siloedNullifier: Fr): void;
    traceNewL2ToL1Message(contractAddress: AztecAddress, recipient: Fr, content: Fr): void;
    tracePublicLog(contractAddress: AztecAddress, log: Fr[]): void;
    traceDebugLog(contractAddress: AztecAddress, level: LogLevel, message: string, fields: Fr[]): void;
    getDebugLogs(): DebugLog[];
    getDebugLogMemoryReads(): number;
    traceDebugLogMemoryReads(memoryReads: number): void;
    traceGetContractClass(contractClassId: Fr, exists: boolean): void;
    getSideEffects(): SideEffects;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2lkZV9lZmZlY3RfdHJhY2UuZC50cyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9wdWJsaWMvc2lkZV9lZmZlY3RfdHJhY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBU0EsT0FBTyxFQUFFLEVBQUUsRUFBRSxNQUFNLGdDQUFnQyxDQUFDO0FBRXBELE9BQU8sRUFBRSxLQUFLLFFBQVEsRUFBRSxLQUFLLE1BQU0sRUFBRSxLQUFLLGNBQWMsRUFBZ0IsTUFBTSx1QkFBdUIsQ0FBQztBQUN0RyxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUVoRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQzNELE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDekQsT0FBTyxFQUFpQixtQkFBbUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBVzdFLE9BQU8sS0FBSyxFQUFFLDhCQUE4QixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFDdkYsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRXZEOzs7O0lBSUk7QUFDSixNQUFNLE1BQU0sV0FBVyxHQUFHO0lBQ3hCLGdCQUFnQixFQUFFLHVCQUF1QixFQUFFLENBQUM7SUFDNUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxDQUFDO0lBQ3ZCLFVBQVUsRUFBRSxTQUFTLEVBQUUsQ0FBQztJQUN4QixVQUFVLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQztJQUNsQyxVQUFVLEVBQUUsU0FBUyxFQUFFLENBQUM7Q0FDekIsQ0FBQztBQUVGLHFCQUFhLHNCQUFzQjthQUVmLGdCQUFnQixFQUFFLE1BQU07YUFDeEIsd0JBQXdCLEVBQUUsTUFBTTthQUNoQyxVQUFVLEVBQUUsTUFBTTthQUNsQixVQUFV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