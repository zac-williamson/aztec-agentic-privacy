import { type Logger, type LoggerBindings } from '@aztec/foundation/log';
import { DateProvider } from '@aztec/foundation/timer';
import { PublicSimulatorConfig } from '@aztec/stdlib/avm';
import type { ContractDataSource } from '@aztec/stdlib/contract';
import type { MerkleTreeWriteOperations, PublicProcessorLimits, PublicProcessorValidator, SequencerConfig } from '@aztec/stdlib/interfaces/server';
import { type FailedTx, GlobalVariables, NestedProcessReturnValues, type ProcessedTx, Tx } from '@aztec/stdlib/tx';
import { type TelemetryClient, type Traceable, type Tracer } from '@aztec/telemetry-client';
import { PublicContractsDB } from '../public_db_sources.js';
import { type PublicTxSimulatorConfig, type PublicTxSimulatorInterface } from '../public_tx_simulator/index.js';
import { GuardedMerkleTreeOperations } from './guarded_merkle_tree.js';
/**
 * Creates new instances of PublicProcessor given the provided merkle tree db and contract data source.
 */
export declare class PublicProcessorFactory {
    private contractDataSource;
    private dateProvider;
    protected telemetryClient: TelemetryClient;
    private log;
    constructor(contractDataSource: ContractDataSource, dateProvider?: DateProvider, telemetryClient?: TelemetryClient, bindings?: LoggerBindings);
    /**
     * Creates a new instance of a PublicProcessor.
     * @param globalVariables - The global variables for the block being processed.
     * @param skipFeeEnforcement - Allows disabling balance checks for fee estimations.
     * @returns A new instance of a PublicProcessor.
     */
    create(merkleTree: MerkleTreeWriteOperations, globalVariables: GlobalVariables, config: PublicSimulatorConfig): PublicProcessor;
    protected createPublicTxSimulator(merkleTree: MerkleTreeWriteOperations, contractsDB: PublicContractsDB, globalVariables: GlobalVariables, config?: Partial<PublicTxSimulatorConfig>): PublicTxSimulatorInterface;
}
/**
 * Converts Txs lifted from the P2P module into ProcessedTx objects by executing
 * any public function calls in them. Txs with private calls only are unaffected.
 */
export declare class PublicProcessor implements Traceable {
    protected globalVariables: GlobalVariables;
    private guardedMerkleTree;
    protected contractsDB: PublicContractsDB;
    protected publicTxSimulator: PublicTxSimulatorInterface;
    private dateProvider;
    private log;
    private opts;
    private metrics;
    constructor(globalVariables: GlobalVariables, guardedMerkleTree: GuardedMerkleTreeOperations, contractsDB: PublicContractsDB, publicTxSimulator: PublicTxSimulatorInterface, dateProvider: DateProvider, telemetryClient: TelemetryClient | undefined, log: Logger, opts?: Pick<SequencerConfig, 'fakeProcessingDelayPerTxMs' | 'fakeThrowAfterProcessingTxCount'>);
    get tracer(): Tracer;
    /**
     * Run each tx through the public circuit and the public kernel circuit if needed.
     * @param txs - Txs to process.
     * @param limits - Limits for processing the txs.
     * @param validator - Pre-process validator and nullifier cache to use for processing the txs.
     * @returns The list of processed txs with their circuit simulation outputs.
     */
    process(txs: Iterable<Tx> | AsyncIterable<Tx>, limits?: PublicProcessorLimits, validator?: PublicProcessorValidator): Promise<[ProcessedTx[], FailedTx[], Tx[], NestedProcessReturnValues[], number]>;
    private checkWorldStateUnchanged;
    private processTx;
    private doTreeInsertionsForPrivateOnlyTx;
    private processTxWithinDeadline;
    private performFeePaymentPublicDataWrite;
    private processPrivateOnlyTx;
    private processTxWithPublicCalls;
    /**
     * Generate the proving request for the AVM circuit.
     */
    private static generateProvingRequest;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHVibGljX3Byb2Nlc3Nvci5kLnRzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL3B1YmxpYy9wdWJsaWNfcHJvY2Vzc29yL3B1YmxpY19wcm9jZXNzb3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0EsT0FBTyxFQUFFLEtBQUssTUFBTSxFQUFFLEtBQUssY0FBYyxFQUFnQixNQUFNLHVCQUF1QixDQUFDO0FBRXZGLE9BQU8sRUFBRSxZQUFZLEVBQWtDLE1BQU0seUJBQXlCLENBQUM7QUFJdkYsT0FBTyxFQU1MLHFCQUFxQixFQUN0QixNQUFNLG1CQUFtQixDQUFDO0FBRTNCLE9BQU8sS0FBSyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFHakUsT0FBTyxLQUFLLEVBQ1YseUJBQXlCLEVBQ3pCLHFCQUFxQixFQUNyQix3QkFBd0IsRUFDeEIsZUFBZSxFQUNoQixNQUFNLGlDQUFpQyxDQUFDO0FBR3pDLE9BQU8sRUFDTCxLQUFLLFFBQVEsRUFDYixlQUFlLEVBQ2YseUJBQXlCLEVBQ3pCLEtBQUssV0FBVyxFQUVoQixFQUFFLEVBR0gsTUFBTSxrQkFBa0IsQ0FBQztBQUMxQixPQUFPLEVBRUwsS0FBSyxlQUFlLEVBQ3BCLEtBQUssU0FBUyxFQUNkLEtBQUssTUFBTSxFQUdaLE1BQU0seUJBQXlCLENBQUM7QUFLakMsT0FBTyxFQUFFLGlCQUFpQixFQUFpQixNQUFNLHlCQUF5QixDQUFDO0FBQzNFLE9BQU8sRUFDTCxLQUFLLHVCQUF1QixFQUM1QixLQUFLLDBCQUEwQixFQUVoQyxNQUFNLGlDQUFpQyxDQUFDO0FBQ3pDLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBR3ZFOztHQUVHO0FBQ0gscUJBQWEsc0JBQXNCO0lBRy9CLE9BQU8sQ0FBQyxrQkFBa0I7SUFDMUIsT0FBTyxDQUFDLFlBQVk7SUFDcEIsU0FBUyxDQUFDLGVBQWUsRUFBRSxlQUFlO0lBSjVDLE9BQU8sQ0FBQyxHQUFHLENBQVM7SUFDcEIsWUFDVSxrQkFBa0IsRUFBRSxrQkFBa0IsRUFDdEMsWUFBWSxHQUFFLFlBQWlDLEVBQzdDLGVBQWUsR0FBRSxlQUFzQyxFQUNqRSxRQUFRLENBQUMsRUFBRSxjQUFjLEVBRzFCO0lBRUQ7Ozs7O09BS0c7SUFDSSxNQUFNLENBQ1gsVUFBVSxFQUFFLHlCQUF5QixFQUNyQyxlQUFlLEVBQUUsZUFBZSxFQUNoQyxNQUFNLEVBQUUscUJBQXFCLEdBQzVCLGVBQWUsQ0FnQmpCO0lBRUQsU0FBUyxDQUFDLHVCQUF1QixDQUMvQixVQUFVLEVBQUUseUJBQXlCLEVBQ3JDLFdBQVcsRUFBRSxpQkFBaUIsRUFDOUIsZUFBZSxFQUFFLGVBQWUsRUFDaEMsTUFBTSxDQUFDLEVBQUUsT0FBTyxDQUFDLHVCQUF1QixDQUFDLEdBQ3hDLDBCQUEwQixDQVM1QjtDQUNGO0FBU0Q7OztHQUdHO0FBQ0gscUJBQWEsZUFBZ0IsWUFBVyxTQUFTO0lBSTdDLFNBQVMsQ0FBQyxlQUFlLEVBQUUsZUFBZTtJQUMxQyxPQUFPLENBQUMsaUJBQWlCO0lBQ3pCLFNBQVMsQ0FBQyxXQUFXLEVBQUUsaUJBQWlCO0lBQ3hDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSwwQkFBMEI7SUFDdkQsT0FBTyxDQUFDLFlBQVk7SUFFcEIsT0FBTyxDQUFDLEdBQUc7SUFDWCxPQUFPLENBQUMsSUFBSTtJQVZkLE9BQU8sQ0FBQyxPQUFPLENBQXlCO0lBRXhDLFlBQ1ksZUFBZSxFQUFFLGVBQWUsRUFDbEMsaUJBQWlCLEVBQUUsMkJBQTJCLEVBQzVDLFdBQVcsRUFBRSxpQkFBaUIsRUFDOUIsaUJBQWlCLEVBQUUsMEJBQTBCLEVBQy9DLFlBQVksRUFBRSxZQUFZLEVBQ2xDLGVBQWUsNkJBQXdDLEVBQy9DLEdBQUcsRUFBRSxNQUFNLEVBQ1gsSUFBSSxHQUFFLElBQUksQ0FBQyxlQUFlLEVBQUUsNEJBQTRCLEdBQUcsaUNBQWlDLENBQU0sRUFHM0c7SUFFRCxJQUFJLE1BQU0sSUFBSSxNQUFNLENBRW5CO0lBRUQ7Ozs7OztPQU1HO0lBQ1UsT0FBTyxDQUNsQixHQUFHLEVBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxHQUFHLGFBQWEsQ0FBQyxFQUFFLENBQUMsRUFDckMsTUFBTSxHQUFFLHFCQUEwQixFQUNsQyxTQUFTLEdBQUUsd0JBQTZCLEdBQ3ZDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLHlCQUF5QixFQUFFLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0E2TWpGO1lBRWEsd0JBQXdCO1lBaUJ4QixTQUFTO1lBMkJULGdDQUFnQztZQTRCaEMsdUJBQXVCO1lBZ0R2QixnQ0FBZ0M7WUEwQmhDLG9CQUFvQjtZQStCcEIsd0JBQXdCO0lBeUN0Qzs7T0FFRztJQUNILE9BQU8sQ0FBQyxNQUFNLENBQUMsc0JBQXNCO0NBU3RDIn0=